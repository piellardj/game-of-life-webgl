!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=null;t.gl=n,t.initGL=function(e){function r(e){Demopage.setErrorMessage("webgl-support",e)}var i=Canvas.getCanvas();if(t.gl=n=i.getContext("webgl",e),null==n){if(t.gl=n=i.getContext("experimental-webgl",e),null==n)return r("Your browser or device does not seem to support WebGL."),!1;r("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.BLEND),n.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,r=Math.floor(n.canvas.clientWidth*t),i=Math.floor(n.canvas.clientHeight*t);n.canvas.width===r&&n.canvas.height===i||(n.canvas.width=r,n.canvas.height=i)}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.id=t.createFramebuffer(),i.width=r,i.height=n,i}return i(t,e),t.bindDefault=function(e,t){void 0===t&&(t=null),e.bindFramebuffer(e.FRAMEBUFFER,null),null===t?e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight):e.viewport(t.left,t.lower,t.width,t.height)},t.prototype.bind=function(t,r){void 0===r&&(r=null);var n=e.prototype.gl.call(this);n.bindFramebuffer(n.FRAMEBUFFER,this.id),n.viewport(0,0,this.width,this.height);for(var i=0;i<t.length;++i)n.framebufferTexture2D(n.FRAMEBUFFER,n["COLOR_ATTACHMENT"+i],n.TEXTURE_2D,t[i],0);r&&(n.bindRenderbuffer(n.RENDERBUFFER,r),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,r))},t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteFramebuffer(this.id),this.id=null},t}(o(r(0)).default);t.default=u},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0});var i;Button.addObserver("stop-start-button-id",function(){l.autorun=!n});var o,u=[],a=[0,.6,.7,.8,.9];Range.addObserver("persistence-range-id",function(e){i=e;for(var t=0,r=u;t<r.length;t++){(0,r[t])(i)}}),i=Range.getValue("persistence-range-id");var s=[];Range.addObserver("scale-range-id",function(e){o=e;for(var t=0,r=s;t<r.length;t++){(0,r[t])(o)}}),o=Range.getValue("scale-range-id");var l=function(){function e(){}return Object.defineProperty(e,"autorun",{get:function(){return n},set:function(e){n=e,Button.setLabel("stop-start-button-id",n?"Stop":"Start")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scale",{get:function(){return o},set:function(e){Range.setValue("scale-range-id",e)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scaleObservers",{get:function(){return s},enumerable:!0,configurable:!0}),Object.defineProperty(e,"persistence",{get:function(){return a[i]},set:function(e){Range.setValue("persistence-range-id",e)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"persistenceObservers",{get:function(){return u},enumerable:!0,configurable:!0}),e}();t.default=l},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(2)),u=i(r(1)),a=r(1),s=n(r(5)),l=n(r(6)),f=n(r(3));!function(){if(u.initGL({alpha:!1,preserveDrawingBuffer:!0})){a.gl.blendFunc(a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA),Canvas.showLoader(!0),f.default.autorun=!0,f.default.scale=1,f.default.persistence=0;var e=new l.default;requestAnimationFrame(function t(){var r=!1;f.default.autorun&&(e.update(),Canvas.setIndicatorText("Iteration",e.iteration),r=!0),(r||e.needToRedraw)&&(o.default.bindDefault(a.gl),u.adjustSize(),s.default.setFullCanvas(a.gl),e.draw()),requestAnimationFrame(t)})}}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n){this.left=e,this.lower=t,this.width=r,this.height=n}return e.setFullCanvas=function(e){e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)},e.prototype.set=function(e){e.viewport(this.lower,this.left,this.width,this.height)},e}();t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var a=o(r(2)),s=r(1),l=o(r(0)),f=u(r(7)),c=o(r(10)),d=o(r(3)),h=function(e){function t(){var t=e.call(this,s.gl)||this;t._FBO=new a.default(s.gl,512,512),t._vbo=c.default.createQuad(s.gl,-1,-1,1,1);var r=function(){var e=Canvas.getSize();t.initializeTextures(e[0],e[1]),t._visibleSubTexture[0]=e[0]/t._textureSize[0],t._visibleSubTexture[1]=e[1]/t._textureSize[1]};return t._mustClear=!0,t._textures=[null,null],t._visibleSubTexture=[0,0],r(),Canvas.Observers.canvasResize.push(r),Button.addObserver("reset-button-id",r),d.default.scaleObservers.push(function(){t._needToRedraw=!0,t._mustClear=!0}),f.buildShader({fragmentFilename:"display-2D.frag",vertexFilename:"display-2D.vert"},function(e){null!==e&&(t._displayShader=e,t._displayShader.a.aCorner.VBO=t._vbo,t._displayShader.u.uSubTexture.value=t._visibleSubTexture)}),f.buildShader({fragmentFilename:"update-2D.frag",vertexFilename:"fullscreen.vert"},function(e){null!==e&&(t._updateShader=e,t._updateShader.a.aCorner.VBO=t._vbo)}),t}return i(t,e),t.prototype.freeGLResources=function(){this._FBO&&this._FBO.freeGLResources(),this._vbo&&(this._vbo.freeGLResources(),this._vbo=null),this._displayShader&&(this._displayShader.freeGLResources(),this._displayShader=null),this._updateShader&&(this._updateShader.freeGLResources(),this._updateShader=null),this.freeTextures()},t.prototype.update=function(){var e=this._updateShader;if(e){var t=this._textures[this._currentIndex],r=this._textures[(this._currentIndex+1)%2];this._FBO.bind([r]),e.u.uPrevious.value=t,e.u.uCellSize.value=[1/this._textureSize[0],1/this._textureSize[1]],e.use(),e.bindUniformsAndAttributes(),s.gl.disable(s.gl.BLEND),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4),this._currentIndex=(this._currentIndex+1)%2,this._iteration++}},t.prototype.draw=function(){var e=this._displayShader;e&&(e.u.uScale.value=d.default.scale,e.u.uClearFactor.value=this._mustClear?1:1-d.default.persistence,e.u.uTexture.value=this._textures[this._currentIndex],e.use(),e.bindUniformsAndAttributes(),s.gl.enable(s.gl.BLEND),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4),Canvas.showLoader(!1),this._needToRedraw=!1,this._mustClear=!1)},Object.defineProperty(t.prototype,"iteration",{get:function(){return this._iteration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"needToRedraw",{get:function(){return this._needToRedraw},enumerable:!0,configurable:!0}),t.prototype.freeTextures=function(){for(var e=0;e<2;++e)this._textures[e]&&(s.gl.deleteTexture(this._textures[e]),this._textures[e]=null)},t.prototype.initializeTextures=function(e,t){function r(e){return Math.pow(2,Math.ceil(Math.log(e)*Math.LOG2E))}e=r(e),t=r(t),this._FBO.width=e,this._FBO.height=t,this._textureSize=[e,t],this.freeTextures();for(var n=new Uint8Array(4*e*t),i=e*t;i>0;--i){var o=255*Math.round(Math.random());n[4*i+0]=o,n[4*i+1]=o,n[4*i+2]=o,n[4*i+3]=255}for(i=0;i<2;++i)this._textures[i]=s.gl.createTexture(),s.gl.bindTexture(s.gl.TEXTURE_2D,this._textures[i]),s.gl.texImage2D(s.gl.TEXTURE_2D,0,s.gl.RGBA,e,t,0,s.gl.RGBA,s.gl.UNSIGNED_BYTE,n),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_MAG_FILTER,s.gl.NEAREST),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_MIN_FILTER,s.gl.NEAREST);this._currentIndex=0,this._iteration=0,this._needToRedraw=!0,Canvas.setIndicatorText("Grid size",e+"x"+t)},t}(l.default);t.default=h},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),u=n(r(8)),a=i(r(9)),s={};function l(e,t){var r=2,n=0;function i(i){if(i||n++,0===--r){var s=null;if(0===n){var l=a.getSource(e.vertexFilename),f=a.getSource(e.fragmentFilename);s=new u.default(o.gl,l,f)}t(s)}}a.loadSource(e.vertexFilename,i),a.loadSource(e.fragmentFilename,i)}t.getShader=function(e){return s[e].shader},t.buildShader=l,t.registerShader=function(e,t,r){function n(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed,e.shader);e.callbacks=[]}if(void 0===s[e]){s[e]={callbacks:[r],failed:!1,infos:t,pending:!0,shader:null};var i=s[e];l(t,function(e){i.pending=!1,i.failed=null===e,i.shader=e,n(i)})}else{var o=s[e];!0===o.pending?o.callbacks.push(r):n(o)}},t.deleteShader=function(e){s[e]&&(s[e].shader&&s[e].shader.freeGLResources(),delete s[e])}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=o(r(0));function a(e,t,r){alert("NOT IMPLEMENTED YET")}var s={35664:{str:"FLOAT_VEC2",binder:function(e,t,r){e.uniform2fv(t,r)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,r){e.uniform3fv(t,r)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,r){e.uniform4fv(t,r)}},35667:{str:"INT_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35668:{str:"INT_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35669:{str:"INT_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35670:{str:"BOOL",binder:function(e,t,r){e.uniform1i(t,+r)}},35671:{str:"BOOL_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35672:{str:"BOOL_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35673:{str:"BOOL_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,r){e.uniformMatrix2fv(t,!1,r)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,r){e.uniformMatrix3fv(t,!1,r)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,r){e.uniformMatrix4fv(t,!1,r)}},35678:{str:"SAMPLER_2D",binder:function(e,t,r,n){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_2D,n)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,r,n){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_CUBE_MAP,n)}},5120:{str:"BYTE",binder:a},5121:{str:"UNSIGNED_BYTE",binder:a},5122:{str:"SHORT",binder:a},5123:{str:"UNSIGNED_SHORT",binder:a},5124:{str:"INT",binder:function(e,t,r){Array.isArray(r),e.uniform1iv(t,r)}},5125:{str:"UNSIGNED_INT",binder:a},5126:{str:"FLOAT",binder:function(e,t,r){Array.isArray(r)?e.uniform1fv(t,r):e.uniform1f(t,r)}}},l=function(e){function t(t,r,n){var i=this;function o(e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.error(t.getShaderInfoLog(n)),t.deleteShader(n),null)}(i=e.call(this,t)||this).id=null,i.uCount=0,i.aCount=0;var u=o(t.VERTEX_SHADER,r),a=o(t.FRAGMENT_SHADER,n),s=t.createProgram();return t.attachShader(s,u),t.attachShader(s,a),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)?(i.id=s,i.introspection()):(console.error(t.getProgramInfoLog(s)),t.deleteProgram(s)),i}return i(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,r=e.prototype.gl.call(this),n=0;Object.keys(this.u).forEach(function(e){var i=t.u[e];if(null!==i.value)if(35678===i.type||35680===i.type){var o=n;s[i.type].binder(r,i.loc,o,i.value),n++}else s[i.type].binder(r,i.loc,i.value)})},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach(function(t){var r=e.a[t];null!==r.VBO&&r.VBO.bind(r.loc)})},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u=[];for(var r=0;r<this.uCount;++r){var n=t.getActiveUniform(this.id,r),i=n.name;this.u[i]={loc:t.getUniformLocation(this.id,i),size:n.size,type:n.type,value:null}}this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a=[];for(r=0;r<this.aCount;++r){var o=t.getActiveAttrib(this.id,r),u=o.name;this.a[u]={VBO:null,loc:t.getAttribLocation(this.id,u),size:o.size,type:o.type}}},t}(u.default);t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};t.loadSource=function(e,t){function r(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed);e.callbacks=[]}if(void 0===n[e]){n[e]={callbacks:[t],failed:!1,pending:!0,text:null};var i=n[e],o=new XMLHttpRequest;o.open("GET","./shaders/"+e,!0),o.onload=function(){4===o.readyState&&(i.pending=!1,200===o.status?(i.text=o.responseText,i.failed=!1):(console.error("Cannot load '"+e+"' shader source: "+o.statusText),i.failed=!0),r(i))},o.onerror=function(){console.error("Cannot load '"+e+"' shader source: "+o.statusText),i.pending=!1,i.failed=!0,r(i)},o.send(null)}else{var u=n[e];!0===u.pending?u.callbacks.push(t):r(u)}},t.getSource=function(e){return n[e].text}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t,r,n,i){var o=e.call(this,t)||this;return o.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.id),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),o.size=n,o.type=i,o.normalize=!1,o.stride=0,o.offset=0,o}return i(t,e),t.createQuad=function(e,r,n,i,o){return new t(e,new Float32Array([r,n,i,n,r,o,i,o]),2,e.FLOAT)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var r=e.prototype.gl.call(this);r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,this.id),r.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t}(o(r(0)).default);t.default=u}]);